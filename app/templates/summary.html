{%extends 'base.html'%}
{%block title%}
Summary - HydraFlow
{%endblock%}

{% block content %}
<div class="container mx-auto p-4">
    <h2 class="mt-5 text-2xl font-semibold text-center">Generate User Summary</h2>
    <div class="flex justify-center mt-4">
        <div class="flex items-end space-x-4">
             <div class="w-70"> 
                <label for="user" class="block text-gray-700">Select User:</label>
                <select id="user" class="block w-full mt-1 p-2 border border-gray-300 rounded-md h-12"> <!-- Fixed height for the select element -->
                    {% for user in users %}
                        <option value="{{ user.id }}">{{ user.email }}</option>
                    {% endfor %}
                </select>
            </div>
            <button id="generate-summary" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-35 h-12">
                Generate
            </button>
        </div>
    </div>
    
    <div class="mt-8 p-4 bg-gray-100 rounded-lg shadow w-full">
        <h3 class="text-xl font-semibold">Summary</h3>
         <div id="loading-message" class="mt-4 text-center text-gray-700 hidden">We are processing your request...</div>
        <div  id="summary-content" class="mt-4 whitespace-pre-wrap">
        
        </div>
    </div>
</div>
<script>
document.getElementById('generate-summary').addEventListener('click', function() {
    const userId = document.getElementById('user').value;
    const loadingMessage = document.getElementById('loading-message');
    const summaryContent = document.getElementById('summary-content');

    loadingMessage.classList.remove('hidden');
    summaryContent.innerHTML = '';
    fetch('/summary', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ userId: userId })
    })
    .then(response => response.json())
    .then(data => {
        loadingMessage.classList.add('hidden');
        summaryContent.innerHTML = data.summary ; 
    })
    .catch(error => {
        console.error('Error fetching summary:', error);
    });
});
</script>
{% endblock %}